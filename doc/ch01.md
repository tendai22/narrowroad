# 1. FORTHが生まれた世界

1970年代のミニコン上のプログラミング環境を感じられるプロセスを、今風の自作ワンボードマイコンと母艦PCの組み合わせの上に実現し、68000機械語・アセンブリ言語で FORTHのワードを整えてゆきます。

私にとってFORTHの魅力は、言語としての側面よりも、実行環境としての側面にある。

* サブルーチンのアドレスを2重ポインタでたどって呼び出してゆく、シンプルな「インタプリタ」。
* 機械語サブルーチンではあるが、部品化して組み合わせるための仕組みである「単語」「辞書」「コンパイル」
* これらの単純な仕組みの組み合わせで「アプリケーション志向」でアプリケーションにくみ上げてゆくプログラミングスタイル。

UNIXでプログラミングに目覚め「小さな部品を組み合わせて問題を解いてゆく」スタイルがしみついている、今でもシェルスクリプトでバッククォート、sedを日常的に使う私にとって、もうひとつの「部品を組み合わせて問題を解いてゆく」仕組みとして魅力的である。UNIXがない時代の「部品箱」アプローチはとても興味深い。

FORTHを発明したCharles Mooreは、機械語サブルーチンの束とインタプリタを引っ提げて、顧客の求めるミニコンに開発環境を一から移植し、その上にアプリケーションを組んだ。この作業を数10種類のミニコンに対して繰り返す中で、FORTH言語が形作られていった。

ならば、私も彼のたどった道をたどろう。新しいCPUに対して、アセンブリ言語を使って機械語サブルーチンを一つ一つ作ってゆく。最終的にFORTH言語が動くようにする。彼が数10回たどった道だが、私がさらに1回たどってもいいじゃないか。このシンプルな開発環境・実行環境を体で味わいたい。ということだ。

* サブルーチン先頭のアドレスの列をソフトウェア部品として実行する。実行は2重ポインタの参照なので実行コードへのジャンプは高速である。
* プログラムはテキストで表現されているが、アドレスの列に変換した状態でメモリ上に展開しているので高速実行できる。
* テキストを解釈する際は空白で区切られた「単語」単位に区切り、単語に対応する部品のアドレスを見つけ出し実行する。

幾つかの機械語部品以外は、すべて数10個のアドレスの列(ポインタの配列)なのでコンパクトであり、当時の限られたメモリ容量でもある程度の規模のアプリケーションを組むことが出来た。

数キロバイトのメモリ、ハードディスクと低速の端末、機械語によるプログラミングで腕を磨いたMooreは、自分独自の開発環境を作り上げてゆく、さまざまなマシンの仕事を受け手元のソフトウェア部品をインタプリタで組み合わせて仕事をこなしてゆく中で彼が作り出したものがFORTHという開発環境だった。60年後半から70年代前半にはコンパイラやライブラリは提供されているがコード品質はよくわからない状況で、自分の手元にある機械語サブルーチンの束を組み合わせて顧客要望に応える。新たなCPUの仕事を受けるとアセンブラを作るところから始め、用意した機械語ルーチン群を「移植」してゆく。数10種類のコンピュータに対してそれを繰り返す中でFORTHという仕組みが出来上がっていった。

* アドレス解決済のサブルーチン呼び出しの列を順次呼び出してゆく実行方法(内部インタプリタ)
* 入力プログラムを単語に区切って、単語を名前-コードのペアのエントリの片方向リスト(辞書)で検索して見つかったコードのアドレスを実行する(外部インタプリタ)
* 単語の列で構成されたモジュールを、辞書で検索してコードのアドレスをメモリ上に順次並べ、そのリストを新しい辞書エントリとする(コンパイル)

という処理をベースとして、

FORTHとして最も初期の記述は[(Moore74)"FORTH: A NEW WAY TO PROGRAM A MINI-COMPUTER"](https://adsabs.harvard.edu/full/1974A%26AS...15..497M)にある。RAM 8kバイト、ハードディスクと端末のつながったミニコンピュータ、フロントパネルのスイッチを操作して、数10バイトのブートローダを1バイト1バイト手打ちで入力して、紙テープからコンパイラを読み込ませ実行する環境。おそらく、FORTH実行環境は紙テープに打ち込んでおき、手打ちブートローダから読み込んでRUNしていたのでしょう。

FORTH実行環境は2kバイトだとのこと。現在の我々の住まいの1000分の1、ひょっとすると100万分の一かもしれない。アプリケーションも数キロバイト、データ領域も数キロバイトの規模感である。現在を生きる我々がこの規模感の世界で何か役に立つ・実用的なものを開発すること自体に意味がないことは、私自身も承知している。だが、Mooreはこの環境で天文台向けアプリケーション(おそらく、望遠鏡を天空の一点に向けながら写真を撮像するようなものなのだろう)を開発し、当時の天文台の人気を博したというのだ。小さな部品の組み合わせ、言語ではあるが、既にある部品とアプリケーション用の部品を追加で開発し組み合わせる。2kBのメモリでも動作する「インタプリタ」と「コンパイラ」なら、我々の世代ならVTLやTiny BASICを思い浮かべるだろう。だが、FORTHには「ソース読み込み・解釈部」自体も幾つかの部品の組み合わせでできており、ここをカスタマイズすることもできる。これを持って
